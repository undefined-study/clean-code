<div align="center">
  <h1>Chapter13 : 동시성</h1>
</div>

**[독서 포인트]**
<br />
📌 멀티 스레딩이 궁금하다..! (멀티 스레딩 언어를 쓴다는 건 어떤 기분일까..!)

<br />

- 동시성과 깔끔한 코드는 양립하기 어렵다고 함.

- 동시성이 필요한 이유

  - 구조와 효율을 개선하기 위해

    - 동시성은 결합을 없애는 전략 -> 동시성은 `무엇`과 `언제`를 분리

    - 이렇게 둘을 분리하면 애플리케이션 구조&효율이 나아진다고 함.

    - 서블릿(servlet)

      > 자바 서블릿은 자바를 사용하여 웹페이지를 동적으로 생성하는 서버측 프로그램 혹은 그 사양을 말하며, 흔히 "서블릿"이라 불린다. 자바 서블릿은 웹 서버의 성능을 향상하기 위해 사용되는 자바 클래스의 일종이다. [위키백과](https://ko.wikipedia.org/wiki/%EC%9E%90%EB%B0%94_%EC%84%9C%EB%B8%94%EB%A6%BF)

      - 서블릿은 자바 소스코드 속에 HTML, JSP는 HTML 소스코드 속에 자바 소스코드 (출처: [MangKyu's Diary:티스토리](https://mangkyu.tistory.com/14))
      
        // 이미지

      - "각 서블릿은 (원칙적으로는) 다른 서블릿 스레드와 무관하게 자신만의 세상에서 돌아간다."

  - 응답 시간과 작업 처리량을 개선하기 위해

    - 예) 웹사이트 돌아다니면서 정보 수집하는 수집기
    
      - 단일 스레드라면 한 번에 한 사이트만 방문할 수 있음.

      - 다중 스레드 알고리즘을 이용하여 수집기 성능 향상

  - ***그.러.나.*** `무엇`과 `언제`를 분리하게 되면 시스템 구조가 크게 달라진다. 또한, 동시성이 성능을 항상 개선하는 것도 아니다. 그리고 동시성은 부하를 유발하고 복잡하고 버그도 재현하기 어렵다!!!

- 동시성 코드로 인해 발생할 수 있는 문제로부터 시스템 방어하는 방법

  - 단일 책임 원칙: "동시성 코드는 다른 코드와 분리하라."

  - 임계영역(critical section)의 수를 줄일 것: 보호할 임계영역은 `synchronized` 키워드로 보호하라고 권장하는데, 이런 임계영역의 수가 많으면 이들 각각에 대해 올바르게 보호했는지 확인하는 작업을 반복해야 한다고 한다..? (즉, DRY 원칙 위반) -> "자료를 캡슐화하고, 공유 자료를 최대한 줄여라."

  - 객체 복사해서 사용하기

  - 스레드는 독립적으로 구현하기

## 실행 모델을 이해하라

- 기본 용어

  - 한정된 자원(Bound Resource): 크기/숫자가 제한적인 자원

    - 예시로 데이터베이스 연결을 들었는데 구체적으로 어떤 이야기인지??

      > DB가 Connection Pool로 접속을 관장하는데, 이는 한정된 자원으로 최소한의 시간을 사용해야 많은 유저가 사용할 수 있기 때문입니다. 만약 바이너리 파일을 DB에 올리면서 오랜 시간 접속을 유지한다면 그만큼 다른 유저가 사용할 수 없을 테고, 결국은 DB에서 감당할 수 있는 유저의 수가 줄어들 것입니다. (출처: [브랜디 랩스](https://labs.brandi.co.kr/2018/01/31/hansj.html))

      > 모바일 한정판 굿즈 판매 이벤트. 대학교 수강신청. 설, 추석 귀성 KTX 예매. 온라인몰 일회용 마스크 판매. 위와 같이 한정된 수량의 물품을 선착순으로 판매하거나 경품을 제공하기 위해 수행되는 이벤트가 있다. 이러한 이벤트는 동시에 많은 사용자가 순간적으로 몰리는 현상이 발생하기 때문에 아무리 여유있는 자원을 가진 시스템이라도 문제가 발생할 가능성이 높아진다. 특히 DB에서 데이터를 조회,수정, 생성하기 위해 사용하는 Connection Pool이 부족해지면 다른 자원이 아무리 여유가 있어도 장애가 발생하곤 한다 (출처: [SK(주) C&C Tech. Blog](https://engineering-skcc.github.io/cloud/tomcat/apache/DB-Pool-For-Event/))

  - 상호 배제(Mutual Exclusion -> Mutex): 한 번에 하나의 스레드만 공유 자료/공유 자원을 사용할 수 있는 경우 (화장실이 한 칸만 있을 때~)

  - 기아(Starvation): 하나 이상의 스레드가 계속 우선순위가 밀려서 오랜 시간동안 자원을 기다리는 상태.. -> 스레드 우선순위를 바꿔줘라~

    - 기아 문제를 해결하기 위한 우선순위 조정 방법 중 하나로 aging(노화) 방법이 있다고 함. 기다린 시간에 비례해서 우선순위를 높여주는~ ([출처](https://yabmoons.tistory.com/655))

  - 교착상태(Deadlock): 여러 스레드가 서로 끝나기를 기다리는 상태

  - 라이브락(Livelock): 락 걸 때 스레드가 서로 방해하는 상태 (복도에서 두 사람이 마주쳤는데, 서로 지나가게 해주려고 사이드로 비키는데 둘이 계속 동시에 똑같은 방향으로 움직여서 둘 다 못지나가는 상황~ 천생연분~)

    - [재미있는 코드 예시](https://stackoverflow.com/questions/1036364/good-example-of-livelock)~~ 공손한 부부가 숫가락 하나로 스프를 먹는데 계속 서로 양보한다는 이야기~~

- 다중 스레드 프로그래밍에서 사용하는 실행 모델

  - 생산자-소비자(Producer-Consumer)

    - 해법: [궁금하시면 클릭~](https://narakit.tistory.com/136)

  - 읽기-쓰기(Readers-Writers)

    - 해법: [궁금하시면 클릭~](https://medium.com/geekculture/solving-the-readers-writers-problem-in-a-multithreaded-environment-cfd3cb5772a7)

  - 식사하는 철학자들(Dining Philosophers)

    - 해법: [궁금하시면 클릭~](https://austingwalters.com/multithreading-dining-philosophers-problem/)